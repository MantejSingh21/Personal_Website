<!DOCTYPE html>
<html lang="en">
  {% include head.html %}
  <body>
    <script>
      if (
        localStorage.theme === "dark" ||
        (!("theme" in localStorage) &&
          window.matchMedia("(prefers-color-scheme: dark)").matches)
      ) {
        document.body.classList.add("theme-dark");
      }
    </script>

    {% include nav.html %}

    <main>
      {{ content }}
    </main>

    {% include footer.html %}

    <script>
      (function () {
        var darkModeToggle = document.querySelector("#theme-toggle");
        if (!darkModeToggle) {
          return;
        }

        function toggleTheme() {
          document.body.classList.toggle("theme-dark");
          updateThemeState();
        }

        function updateThemeState() {
          var isDarkMode = document.body.classList.contains("theme-dark");
          var theme = isDarkMode ? "dark" : "light";
          try {
            localStorage.setItem("theme", theme);
          } catch (e) {}
          darkModeToggle.setAttribute("aria-checked", isDarkMode.toString());
        }

        function initializeTheme() {
          var isDarkMode = document.body.classList.contains("theme-dark");
          darkModeToggle.setAttribute("aria-checked", isDarkMode.toString());
        }

        darkModeToggle.addEventListener("click", toggleTheme);

        window.addEventListener("keydown", function (e) {
          var active = document.activeElement;
          if (
            (active &&
              (active.tagName === "INPUT" || active.tagName === "TEXTAREA")) ||
            e.ctrlKey ||
            e.metaKey
          ) {
            return;
          }
          if (e.key === "d" || e.key === "D") {
            toggleTheme();
          }
        });

        initializeTheme();
      })();
    </script>
  </body>
</html>
